<p align="center"><a href="https://laravel.com" target="_blank"><img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Laravel Logo"></a></p>

<h1 align="center"><a href="https://frankenphp.dev"><img src="frankenphp.png" alt="FrankenPHP" width="400"></a></h1>

## Благотворительный REST API для управления проектами и пожертвованиями

(http://127.0.0.1/)

Stack:
- Laravel 11 (Octane/FrankenPHP) - PHP 8.2+
- PostgreSQL
- Redis

Dashboards:
- Horizon (http://127.0.0.1/horizon/dashboard)

# Getting Started

## Настройка окружения

1. Скопируйте файл окружения:
```bash
cp .env.example .env --update=none
```
2. Настройте необходимые переменные в `.env`:
```bash
APP_NAMESPACE=value # value - префикс к сервисам docker-compose 
```
3. Инициализация проекта:


```bash
make init
```


## Особенности реализации

### 1. PostgreSQL Триггер

Автоматическая синхронизация денормализованного поля `donation_amount` в таблице `charity_projects`:

```sql
-- Функция триггера обновляет сумму при INSERT, UPDATE, DELETE пожертвований
CREATE TRIGGER trigger_donations_insert
AFTER INSERT ON donations
FOR EACH ROW
EXECUTE FUNCTION update_charity_project_donation_amount();
```

### 2. moneyphp/money для работы с валютой

### 3. HTML Санитизация - stevebauman/purify

## Тестовое задание для разработчика Laravel 
Есть сущность "проект благотворительности" со следующими характеристиками: 
- ID, 
Наименование проекта, текст, обязательно, длина  до 255 символов 
- SLUG, обязательное, уникальное длина до 128 знаков (часть URI страницы) 
- Краткое описание проекта, html код обязательно длина  до 5000 символов. 
- Статус, перечисление:  черновик, активен, закрыт 
- Дата запуска проекта, дата/время 
- Дополнительное описание, html код, необязательно до 50000 символов, 
- Сумма пожертвований(в рублях) : неотрицательное число, по умолчанию 0 
- Порядок сортировки: целое число, необязательно, по умолчанию 1000000. 

Есть сущность пожертвование, у одного проекта благотворительности много пожертвований, 
пожертвование принадлежит только одному проекту благотворительности: 
- ID, 
- ID проекта благотворительности, 
- Дата пожертвования, дата/время обязательное 
- Сумма,  положительное число, обязательное 
- Комментарий, текст до 1000 знаков, необязательное 


# Метод 1 Публичного API. Получение списка проектов благотворительности: 
Требования 
1) фильтрацию по дате запуска проекта, и статусу. По умолчанию выводятся только в статусе 
активен, с любой датой, но должна быть возможность просмотреть и в статусе закрыт. В статусе 
черновик не выводятся никогда в публичном API 
2) сортировку по "порядок сортировки","дата запуска проекта", "сумма пожертвований" по 
умолчанию проекты выводятся отсортированные по возрастанию порядок сортировки и по 
убыванию даты запуска проекта 
3) Поддержка пагинации и указания числа элементов на странице, по умолчанию 3, но не более 10. 

4) выводимые поля: Наименование проекта,SLUG, Краткое описание проекта, Статус, Дата 
запуска проекта 

# Метод 2 Публичного API.  Получение одного проекта благотворительности по SLUG 
Требования 
1) выводимые поля: Наименование проекта, SLUG, Краткое описание проекта, Статус, Дата 
запуска проекта, Сумма пожертвований (округлить до целых),  Дополнительное описание 

# Метод 3. Пожертвовать 
Требования 
1) метод принимает  в обязательном порядке ID проекта благотворительности, и сумму 
пожертвования, сохраняет данные в сущности пожертвование,  при этом у проекта должна 
пересчитаться  cумма пожертвований проекта. Учитываем что не только   этим методом могут 
создаваться сущности "пожертвование".  Дополнительные параметры Дата пожертвования и 
комментарий, если Дата пожертвования  не передано, то настоящее время. Можно передать 
Дата пожертвования  в прошлом (пожертвовать задним числом), но недопустима Дата 
пожертвования будущая.  

## Commonly used tasks

```bash
make exec # контейнер laravel
```
```bash
make up # поднять контейнеры для локальной разработки
```
```bash
make stop
```
```bash
make tink
```
```bash
make check # проверка качества кода
```
